

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>5. Parameter Synthesis with A/G Contract &mdash; PyCASSE v1.0  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="6. Examples" href="examples.html" />
    <link rel="prev" title="4. Control Synthesis with A/G Contract" href="contracts_w_dyn.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> PyCASSE v1.0
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">1. Installing PyCASSE</a></li>
<li class="toctree-l1"><a class="reference internal" href="specifications.html">2. Writing Specifications for PyCASSE</a></li>
<li class="toctree-l1"><a class="reference internal" href="contracts.html">3. Assume-Guarantee (A/G) Contracts</a></li>
<li class="toctree-l1"><a class="reference internal" href="contracts_w_dyn.html">4. Control Synthesis with A/G Contract</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. Parameter Synthesis with A/G Contract</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#parameterization-of-ststl-formulas-and-component-models">5.1. Parameterization of StSTL Formulas and Component Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parameter-synthesis-with-pststl-a-g-contract-in-pycasse">5.2. Parameter Synthesis with PStSTL A/G Contract in PyCASSE</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#synthesizing-parameters-for-requirements">5.2.1. Synthesizing Parameters for Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#synthesizing-parameters-for-components">5.2.2. Synthesizing Parameters for Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#synthesizing-parameters-under-refinement">5.2.3. Synthesizing Parameters under Refinement</a></li>
<li class="toctree-l3"><a class="reference internal" href="#synthesizing-parameters-for-components-with-dynamics">5.2.4. Synthesizing Parameters for Components with Dynamics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pycasse-parameter-synthesis-functions">5.3. PyCASSE Parameter Synthesis Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">6. Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="bib.html">7. Bibiliography</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PyCASSE v1.0</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>5. Parameter Synthesis with A/G Contract</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/contracts_w_param.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="parameter-synthesis-with-a-g-contract">
<h1>5. Parameter Synthesis with A/G Contract<a class="headerlink" href="#parameter-synthesis-with-a-g-contract" title="Permalink to this headline">¶</a></h1>
<div class="section" id="parameterization-of-ststl-formulas-and-component-models">
<h2>5.1. Parameterization of StSTL Formulas and Component Models<a class="headerlink" href="#parameterization-of-ststl-formulas-and-component-models" title="Permalink to this headline">¶</a></h2>
<p>Parameteric Stochastic Signal Temporal Logic (PStSTL) <a class="reference internal" href="bib.html#oh22" id="id1">[Oh22]</a> extends StSTL <a class="reference internal" href="bib.html#nuzzo19" id="id2">[Nuzzo19]</a> with parameters.
Let <span class="math notranslate nohighlight">\(\pi \in \Pi\)</span> be a set of parameters partitioned into two disjoint sets of signal parameters,
<span class="math notranslate nohighlight">\(\pi_s = \{ s_1, s_2, \ldots \}\)</span>, with domain <span class="math notranslate nohighlight">\(\Pi_s\)</span>, and probability threshold parameters, <span class="math notranslate nohighlight">\(\pi_p = \{ p_1, p_2, \ldots \}\)</span>, with domain <span class="math notranslate nohighlight">\(\Pi_p\)</span>.
We denote a PStSTL formula <span class="math notranslate nohighlight">\(\phi\)</span> parametrized by <span class="math notranslate nohighlight">\(\pi\)</span> by <span class="math notranslate nohighlight">\(\phi(\pi)\)</span>.
For example, <span class="math notranslate nohighlight">\(\phi(\pi) := \mathbf{F}_{[0,5]} (x + s)^{\left[ p \right]}\)</span> has parameter set <span class="math notranslate nohighlight">\(\pi = \{ s, p \}\)</span>.
Similarly to how an A/G contract can be expressed using STL or StSTL, PStSTL can be utilized to write an A/G contract.
We denote such A/G contract as PStSTL A/G contract.</p>
<p>During the design process, some constants in a system may be regarded as design parameters.
We represent such scenario with a parametric system (component) <span class="math notranslate nohighlight">\(M(\pi_M)\)</span>, where <span class="math notranslate nohighlight">\(\pi_M\)</span> is a set of parameters.
In this chapter, we show how PyCASSE can be used to synthesize optimal parameter values, guided by the cost function <span class="math notranslate nohighlight">\(J\)</span>,
such that the implementation relationship, i.e., <span class="math notranslate nohighlight">\(M(\pi_M) \models C(\pi_C)\)</span>,
or the refinement relationship, i.e., <span class="math notranslate nohighlight">\(C_2(\pi_C) \preceq C_1\)</span>, hold.</p>
</div>
<div class="section" id="parameter-synthesis-with-pststl-a-g-contract-in-pycasse">
<h2>5.2. Parameter Synthesis with PStSTL A/G Contract in PyCASSE<a class="headerlink" href="#parameter-synthesis-with-pststl-a-g-contract-in-pycasse" title="Permalink to this headline">¶</a></h2>
<div class="section" id="synthesizing-parameters-for-requirements">
<h3>5.2.1. Synthesizing Parameters for Requirements<a class="headerlink" href="#synthesizing-parameters-for-requirements" title="Permalink to this headline">¶</a></h3>
<a class="reference internal image-reference" href="_images/test_parameteric_sys1.png"><img alt="_images/test_parameteric_sys1.png" class="align-center" src="_images/test_parameteric_sys1.png" style="width: 300px;" /></a>
<p>Consider a component <span class="math notranslate nohighlight">\(M_1\)</span> which has a nondeterministic input <span class="math notranslate nohighlight">\(w\)</span> and an output <span class="math notranslate nohighlight">\(u\)</span>.
A PStSTL A/G contract for <span class="math notranslate nohighlight">\(M\)</span>, <span class="math notranslate nohighlight">\(C_1(p,c) = (V_1,A_1,G_1(p,c))\)</span> where <span class="math notranslate nohighlight">\(V_1 := \{ u, w \}\)</span>, <span class="math notranslate nohighlight">\(A_1 := \top\)</span>,
and <span class="math notranslate nohighlight">\(G_1(p,c) := \mathbb{P} \{ w + u \leq c \} \geq p\)</span>, can be created as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pycasse</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">c1</span> <span class="o">=</span> <span class="n">contract</span><span class="p">(</span><span class="s1">&#39;c1&#39;</span><span class="p">)</span>                                       <span class="c1"># Create a contract c1</span>
<span class="n">c1</span><span class="o">.</span><span class="n">add_nondeter_vars</span><span class="p">([</span><span class="s1">&#39;w&#39;</span><span class="p">],</span>  <span class="n">mean</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> \
            <span class="n">cov</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">2</span><span class="o">**</span><span class="mi">2</span><span class="p">]],</span> <span class="n">dtypes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GAUSSIAN&#39;</span><span class="p">])</span>          <span class="c1"># Set nondeterministic variables</span>
<span class="n">c1</span><span class="o">.</span><span class="n">add_param_vars</span><span class="p">([</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="n">bounds</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span> <span class="c1"># Set parameteric variables</span>
<span class="n">c1</span><span class="o">.</span><span class="n">set_assume</span><span class="p">(</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>                                     <span class="c1"># Set/define the assumptions</span>
<span class="n">c1</span><span class="o">.</span><span class="n">set_guaran</span><span class="p">(</span><span class="s1">&#39;P[p] (w &lt;= c)&#39;</span><span class="p">)</span>                            <span class="c1"># Set/define the guarantees</span>
<span class="n">c1</span><span class="o">.</span><span class="n">saturate</span><span class="p">()</span>                                             <span class="c1"># Saturate c</span>
<span class="n">c1</span><span class="o">.</span><span class="n">printInfo</span><span class="p">()</span>                                            <span class="c1"># Print c</span>
</pre></div>
</div>
<p>Given the cost function <span class="math notranslate nohighlight">\(J(p, c) = -10p + c\)</span>, the optimal parameter values which guarantee the implementation relationship,
i.e., <span class="math notranslate nohighlight">\(M_1 \models C_1(p, c)\)</span>, can be found by running:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c1</span><span class="o">.</span><span class="n">find_opt_param</span><span class="p">({</span><span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="n">N</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>              <span class="c1"># Find the optimal parameters (p, c)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/test_parameteric_result1.png"><img alt="_images/test_parameteric_result1.png" class="align-center" src="_images/test_parameteric_result1.png" style="width: 300px;" /></a>
<p>All the parameter values in the green boxes (SAT partitions) guarantee that the implementation relationship holds.
The red boxes indicate UNSAT partitions and the grey boxes indicate UNDET partitions.
The set of optimal parameter values is <span class="math notranslate nohighlight">\((p^*, c^*) = (0.875, 3)\)</span>, which is within the SAT region.</p>
</div>
<div class="section" id="synthesizing-parameters-for-components">
<h3>5.2.2. Synthesizing Parameters for Components<a class="headerlink" href="#synthesizing-parameters-for-components" title="Permalink to this headline">¶</a></h3>
<a class="reference internal image-reference" href="_images/test_parameteric_sys2.png"><img alt="_images/test_parameteric_sys2.png" class="align-center" src="_images/test_parameteric_sys2.png" style="width: 300px;" /></a>
<p>Consider a parameterized component <span class="math notranslate nohighlight">\(M_2(\mu, \sigma)\)</span> which only accepts a nondeterministic input <span class="math notranslate nohighlight">\(w\)</span>.
An A/G contract for <span class="math notranslate nohighlight">\(M_2(\mu, \sigma)\)</span>, <span class="math notranslate nohighlight">\(C_2 = (V_2,A_2,G_2)\)</span> where <span class="math notranslate nohighlight">\(V_2 := \{ w \}\)</span>, <span class="math notranslate nohighlight">\(A_2 := \top\)</span>,
and <span class="math notranslate nohighlight">\(G_2 := \mathbb{P} \{ w \leq 0 \} \geq 0.99\)</span> can be created as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c2</span> <span class="o">=</span> <span class="n">contract</span><span class="p">(</span><span class="s1">&#39;c2&#39;</span><span class="p">)</span>                                                       <span class="c1"># Create a contract c2</span>
<span class="n">c2</span><span class="o">.</span><span class="n">add_nondeter_vars</span><span class="p">([</span><span class="s1">&#39;w&#39;</span><span class="p">],</span>  <span class="n">mean</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span> \
            <span class="n">cov</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;sigma^2&#39;</span><span class="p">]],</span> <span class="n">dtypes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GAUSSIAN&#39;</span><span class="p">])</span>                     <span class="c1"># Set nondeterministic variables</span>
<span class="n">c2</span><span class="o">.</span><span class="n">add_param_vars</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">],</span> <span class="n">bounds</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]])</span> <span class="c1"># Set parameteric variables</span>
<span class="n">c2</span><span class="o">.</span><span class="n">set_assume</span><span class="p">(</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>                                                     <span class="c1"># Set/define the assumptions</span>
<span class="n">c2</span><span class="o">.</span><span class="n">set_guaran</span><span class="p">(</span><span class="s1">&#39;P[0.99] (w &lt;= 0)&#39;</span><span class="p">)</span>                                         <span class="c1"># Set/define the guarantees</span>
<span class="n">c2</span><span class="o">.</span><span class="n">saturate</span><span class="p">()</span>                                                             <span class="c1"># Saturate c</span>
<span class="n">c1</span><span class="o">.</span><span class="n">printInfo</span><span class="p">()</span>                                                            <span class="c1"># Print c</span>
</pre></div>
</div>
<p>Given the cost function <span class="math notranslate nohighlight">\(J(\mu, \sigma) = \mu - 10 \sigma\)</span>, the optimal parameter values which guarantee the implementation relationship,
i.e., <span class="math notranslate nohighlight">\(M_2(\mu, \sigma) \models C_2\)</span>, can be found by running:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c2</span><span class="o">.</span><span class="n">find_opt_param</span><span class="p">({</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">},</span> <span class="n">N</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>                       <span class="c1"># Find the optimal parameters (mean, sigma)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/test_parameteric_result2.png"><img alt="_images/test_parameteric_result2.png" class="align-center" src="_images/test_parameteric_result2.png" style="width: 300px;" /></a>
<p>The set of optimal parameter values is <span class="math notranslate nohighlight">\((\mu^*, \sigma^*) = (-0.1, 0.0409375)\)</span>, which is within the SAT region.</p>
</div>
<div class="section" id="synthesizing-parameters-under-refinement">
<h3>5.2.3. Synthesizing Parameters under Refinement<a class="headerlink" href="#synthesizing-parameters-under-refinement" title="Permalink to this headline">¶</a></h3>
<a class="reference internal image-reference" href="_images/test_parameteric_refinement_sys.png"><img alt="_images/test_parameteric_refinement_sys.png" class="align-center" src="_images/test_parameteric_refinement_sys.png" style="width: 300px;" /></a>
<p>Consider the parameterized component <span class="math notranslate nohighlight">\(M(\sigma)\)</span> which only accepts a nondeterministic input <span class="math notranslate nohighlight">\(w\)</span>.
Two A/G contracts for <span class="math notranslate nohighlight">\(M(\sigma)\)</span>, <span class="math notranslate nohighlight">\(C_1(p) = (V_1,A_1,G_1(p))\)</span> and <span class="math notranslate nohighlight">\(C_2 = (V_2,A_2,G_2)\)</span> can be created as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pycasse</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Build a contract</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">contract</span><span class="p">(</span><span class="s1">&#39;c1&#39;</span><span class="p">)</span>                                   <span class="c1"># Create a contract c1</span>
<span class="n">c1</span><span class="o">.</span><span class="n">add_param_vars</span><span class="p">([</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">],</span> <span class="n">bounds</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span> <span class="c1"># Set parameteric variables</span>
<span class="n">c1</span><span class="o">.</span><span class="n">add_nondeter_vars</span><span class="p">([</span><span class="s1">&#39;w&#39;</span><span class="p">],</span>  <span class="n">mean</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> \
            <span class="n">cov</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;sigma^2&#39;</span><span class="p">]],</span> <span class="n">dtypes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GAUSSIAN&#39;</span><span class="p">])</span> <span class="c1"># Set nondeterministic variables</span>
<span class="n">c1</span><span class="o">.</span><span class="n">set_assume</span><span class="p">(</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>                                 <span class="c1"># Set/define the assumptions</span>
<span class="n">c1</span><span class="o">.</span><span class="n">set_guaran</span><span class="p">(</span><span class="s1">&#39;P[p] (w &lt;= 1.5)&#39;</span><span class="p">)</span>                      <span class="c1"># Set/define the guarantees</span>
<span class="n">c1</span><span class="o">.</span><span class="n">saturate</span><span class="p">()</span>                                         <span class="c1"># Saturate c1</span>

<span class="c1"># Build a contract</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">contract</span><span class="p">(</span><span class="s1">&#39;c2&#39;</span><span class="p">)</span>                                   <span class="c1"># Create a contract c2</span>
<span class="n">c2</span><span class="o">.</span><span class="n">add_param_vars</span><span class="p">([</span><span class="s1">&#39;sigma&#39;</span><span class="p">],</span> <span class="n">bounds</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>    <span class="c1"># Set parameteric variables</span>
<span class="n">c2</span><span class="o">.</span><span class="n">add_nondeter_vars</span><span class="p">([</span><span class="s1">&#39;w&#39;</span><span class="p">],</span>  <span class="n">mean</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> \
            <span class="n">cov</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;sigma^2&#39;</span><span class="p">]],</span> <span class="n">dtypes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GAUSSIAN&#39;</span><span class="p">])</span> <span class="c1"># Set nondeterministic variables</span>
<span class="n">c2</span><span class="o">.</span><span class="n">set_assume</span><span class="p">(</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>                                 <span class="c1"># Set/define the assumptions</span>
<span class="n">c2</span><span class="o">.</span><span class="n">set_guaran</span><span class="p">(</span><span class="s1">&#39;P[0.9] (w &lt;= 1.5)&#39;</span><span class="p">)</span>                    <span class="c1"># Set/define the guarantees</span>
<span class="n">c2</span><span class="o">.</span><span class="n">saturate</span><span class="p">()</span>                                         <span class="c1"># Saturate c2</span>
</pre></div>
</div>
<p>where <span class="math notranslate nohighlight">\(V_1, V_2 := \{ w \}\)</span>, <span class="math notranslate nohighlight">\(A_1, A_2 := \top\)</span>, <span class="math notranslate nohighlight">\(G_1(p) := \mathbb{P} \{ w \leq 1.5 \} \geq p\)</span>,
and <span class="math notranslate nohighlight">\(G_2 := \mathbb{P} \{ w \leq 1.5 \} \geq 0.9\)</span>.</p>
<p>Given the cost function <span class="math notranslate nohighlight">\(J(p, \sigma) = - p - \sigma\)</span>, the optimal parameter values which guarantee the refinement relationship,
i.e., <span class="math notranslate nohighlight">\(C_2(p) \preceq C_1\)</span>, while <span class="math notranslate nohighlight">\(M(\sigma) \models C_2(p)\)</span> can be found by running:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c2</span><span class="o">.</span><span class="n">find_opt_refine_param</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;sigma&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="n">N</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span> <span class="c1"># Find an optimal set of parameters for refinement to hold</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/test_parameteric_refinement_fig.png"><img alt="_images/test_parameteric_refinement_fig.png" class="align-center" src="_images/test_parameteric_refinement_fig.png" style="width: 300px;" /></a>
<p>The set of optimal parameter values is <span class="math notranslate nohighlight">\((p^*, \sigma^*) = (1.147, 0.875)\)</span>, which is within the SAT region.</p>
<a class="reference internal image-reference" href="_images/test_parameteric_refinement2_sys.png"><img alt="_images/test_parameteric_refinement2_sys.png" class="align-center" src="_images/test_parameteric_refinement2_sys.png" style="width: 300px;" /></a>
<p>Now, consider the parameterized component <span class="math notranslate nohighlight">\(M(\sigma)\)</span> which only accepts a nondeterministic input <span class="math notranslate nohighlight">\(w\)</span>.
Two A/G contracts for <span class="math notranslate nohighlight">\(M(\sigma)\)</span>, <span class="math notranslate nohighlight">\(C_1(c) = (V_1,A_1,G_1(c))\)</span> and <span class="math notranslate nohighlight">\(C_2 = (V_2,A_2,G_2)\)</span> can be created as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pycasse</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Build a contract</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">contract</span><span class="p">(</span><span class="s1">&#39;c1&#39;</span><span class="p">)</span>                                   <span class="c1"># Create a contract c1</span>
<span class="n">c1</span><span class="o">.</span><span class="n">add_param_vars</span><span class="p">([</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="n">bounds</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>
<span class="n">c1</span><span class="o">.</span><span class="n">add_nondeter_vars</span><span class="p">([</span><span class="s1">&#39;w&#39;</span><span class="p">],</span>  <span class="n">mean</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> \
            <span class="n">cov</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;sigma^2&#39;</span><span class="p">]],</span> <span class="n">dtypes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GAUSSIAN&#39;</span><span class="p">])</span> <span class="c1"># Set nondeterministic uncontrolled variables</span>
<span class="n">c1</span><span class="o">.</span><span class="n">set_assume</span><span class="p">(</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>                                 <span class="c1"># Set/define the assumptions</span>
<span class="n">c1</span><span class="o">.</span><span class="n">set_guaran</span><span class="p">(</span><span class="s1">&#39;P[0.9] (w &lt;= c)&#39;</span><span class="p">)</span>                      <span class="c1"># Set/define the guarantees</span>
<span class="n">c1</span><span class="o">.</span><span class="n">saturate</span><span class="p">()</span>                                         <span class="c1"># Saturate c1</span>
<span class="n">c1</span><span class="o">.</span><span class="n">printInfo</span><span class="p">()</span>                                        <span class="c1"># Print c1</span>

<span class="c1"># Build a contract</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">contract</span><span class="p">(</span><span class="s1">&#39;c2&#39;</span><span class="p">)</span>                                   <span class="c1"># Create a contract c2</span>
<span class="n">c2</span><span class="o">.</span><span class="n">add_param_vars</span><span class="p">([</span><span class="s1">&#39;sigma&#39;</span><span class="p">],</span> <span class="n">bounds</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>
<span class="n">c2</span><span class="o">.</span><span class="n">add_nondeter_vars</span><span class="p">([</span><span class="s1">&#39;w&#39;</span><span class="p">],</span>  <span class="n">mean</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> \
            <span class="n">cov</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;sigma^2&#39;</span><span class="p">]],</span> <span class="n">dtypes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GAUSSIAN&#39;</span><span class="p">])</span> <span class="c1"># Set nondeterministic uncontrolled variables</span>
<span class="n">c2</span><span class="o">.</span><span class="n">set_assume</span><span class="p">(</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>                                 <span class="c1"># Set/define the assumptions</span>
<span class="n">c2</span><span class="o">.</span><span class="n">set_guaran</span><span class="p">(</span><span class="s1">&#39;P[0.9] (w &lt;= 1.5)&#39;</span><span class="p">)</span>                    <span class="c1"># Set/define the guarantees</span>
<span class="n">c2</span><span class="o">.</span><span class="n">saturate</span><span class="p">()</span>                                         <span class="c1"># Saturate c2</span>
<span class="n">c2</span><span class="o">.</span><span class="n">printInfo</span><span class="p">()</span>                                        <span class="c1"># Print c2</span>

<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">c2</span><span class="o">.</span><span class="n">find_opt_refine_param</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;sigma&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="n">N</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time elaspsed for MILP: </span><span class="si">{}</span><span class="s2"> [seconds].</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
</pre></div>
</div>
<p>where <span class="math notranslate nohighlight">\(V_1, V_2 := \{ w \}\)</span>, <span class="math notranslate nohighlight">\(A_1, A_2 := \top\)</span>, <span class="math notranslate nohighlight">\(G_1(c) := \mathbb{P} \{ w \leq c \} \geq 0.9\)</span>,
and <span class="math notranslate nohighlight">\(G_2 := \mathbb{P} \{ w \leq 1.5 \} \geq 0.9\)</span>.</p>
<p>Given the cost function <span class="math notranslate nohighlight">\(J(\sigma, c) = - 10 \sigma + c\)</span>, the optimal parameter values which guarantee the refinement relationship,
i.e., <span class="math notranslate nohighlight">\(C_2 \preceq C_1(c)\)</span>, while <span class="math notranslate nohighlight">\(M(\sigma) \models C_1(c)\)</span> can be found by running:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c2</span><span class="o">.</span><span class="n">find_opt_refine_param</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;sigma&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="n">N</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span> <span class="c1"># Find an optimal set of parameters for refinement to hold</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/test_parameteric_refinement2_fig.png"><img alt="_images/test_parameteric_refinement2_fig.png" class="align-center" src="_images/test_parameteric_refinement2_fig.png" style="width: 300px;" /></a>
<p>The set of optimal parameter values is <span class="math notranslate nohighlight">\((\sigma^*, c^*) = (1.147, 1.5)\)</span>, which is within the SAT region.</p>
</div>
<div class="section" id="synthesizing-parameters-for-components-with-dynamics">
<h3>5.2.4. Synthesizing Parameters for Components with Dynamics<a class="headerlink" href="#synthesizing-parameters-for-components-with-dynamics" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/dyn_ststl.png"><img alt="_images/dyn_ststl.png" src="_images/dyn_ststl.png" style="width: 300px;" /></a>
</div>
<p>The dynamics of the point-mass robot <span class="math notranslate nohighlight">\(M\)</span> on a line is given as <span class="math notranslate nohighlight">\(x_{k+1} = A x_k + B u_k + w_k\)</span> where <span class="math notranslate nohighlight">\(x_k = [s_k, v_k]^T\)</span> and <span class="math notranslate nohighlight">\(u_k = [a_k]\)</span>.
The goal is to synthesize optimal parameter values <span class="math notranslate nohighlight">\((p^*, c^*)\)</span> such that
the robot eventually in <span class="math notranslate nohighlight">\(10~s\)</span> reaches the region <span class="math notranslate nohighlight">\(\{ r | r \geq c\}\)</span> with probability larger than or equal to <span class="math notranslate nohighlight">\(p\)</span>, i.e., <span class="math notranslate nohighlight">\(\phi_G := \mathbf{F}_{[0,10]} (\mathbb{P} \{ s \geq c \} \geq p)\)</span> is satisfied.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pycasse</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Build a contract</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">contract</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>                               <span class="c1"># Create a contract c</span>
<span class="n">c</span><span class="o">.</span><span class="n">add_deter_vars</span><span class="p">([</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">],</span>
   <span class="n">bounds</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2000</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>  <span class="c1"># Set a deterministic variables</span>
<span class="n">c</span><span class="o">.</span><span class="n">add_param_vars</span><span class="p">([</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span>
   <span class="n">bounds</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">60</span><span class="p">]])</span>
<span class="n">c</span><span class="o">.</span><span class="n">set_assume</span><span class="p">(</span><span class="s1">&#39;G[0,9] (a == 1)&#39;</span><span class="p">)</span>                 <span class="c1"># Set/define the assumptions</span>
<span class="n">c</span><span class="o">.</span><span class="n">set_guaran</span><span class="p">(</span><span class="s1">&#39;F[0,10] (P[p] (s =&gt; c))&#39;</span><span class="p">)</span>         <span class="c1"># Set/define the guarantees</span>
<span class="n">c</span><span class="o">.</span><span class="n">saturate</span><span class="p">()</span>                                    <span class="c1"># Saturate c</span>
<span class="n">c</span><span class="o">.</span><span class="n">printInfo</span><span class="p">()</span>                                   <span class="c1"># Print c</span>

<span class="c1"># Dynamics</span>
<span class="n">dynamics</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">],</span>
   <span class="s1">&#39;u&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">],</span>
   <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
   <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
   <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">**</span><span class="mi">2</span><span class="p">]]</span>
<span class="p">}</span>

<span class="c1"># Initial conditions</span>
<span class="n">init_conditions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;s == 0&#39;</span><span class="p">,</span> <span class="s1">&#39;v == 0&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>where <span class="math notranslate nohighlight">\(V := \{ s, v, a \}\)</span>, <span class="math notranslate nohighlight">\(A := \mathbf{G}_{[0,9]} (a=1)\)</span>, <span class="math notranslate nohighlight">\(G(p) := \mathbf{F}_{[0,10]} \mathbb{P} \{ c \leq s \} \geq p\)</span>.</p>
<p>Given the cost function <span class="math notranslate nohighlight">\(J(p, c) = - 100 p - c\)</span>, the optimal parameter values which guarantee the refinement relationship,
i.e., <span class="math notranslate nohighlight">\(M \models C(p, c)\)</span> can be found by running:</p>
<a class="reference internal image-reference" href="_images/test_dyn_ststl_param_fig.png"><img alt="_images/test_dyn_ststl_param_fig.png" class="align-center" src="_images/test_dyn_ststl_param_fig.png" style="width: 300px;" /></a>
<p>The set of optimal parameter values is <span class="math notranslate nohighlight">\((p^*, c^*) = (0.9438, 31.2500)\)</span>, which is within the SAT region.</p>
</div>
</div>
<div class="section" id="pycasse-parameter-synthesis-functions">
<h2>5.3. PyCASSE Parameter Synthesis Functions<a class="headerlink" href="#pycasse-parameter-synthesis-functions" title="Permalink to this headline">¶</a></h2>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="examples.html" class="btn btn-neutral float-right" title="6. Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="contracts_w_dyn.html" class="btn btn-neutral float-left" title="4. Control Synthesis with A/G Contract" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Chanwook Oh.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>